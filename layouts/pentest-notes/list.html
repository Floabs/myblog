{{ define "main" }}
{{- $sections := .Sections.ByWeight -}}
<section class="section">
  <div class="container pentest-layout">
    <aside class="pentest-sidebar">
      <div class="sticky">
        {{ partial "pentest-tree.html" (dict "current" . "allOpen" true) }}
      </div>
    </aside>
    <div class="pentest-main">
      <div class="section-header">
        <p class="eyebrow">Pentest Notes</p>
        <h1>{{ .Title }}</h1>
        {{ if .Content }}<div class="section-lede">{{ .Content }}</div>{{ end }}
        <div class="note-actions">
          <a class="btn" href="/search/">Search Notes</a>
          <a class="btn ghost" href="/tags/">Browse Tags</a>
        </div>
      </div>
      <div class="content">
        <div class="note-index">
          <h2>Category Index</h2>
          <p class="summary">Jump by topic or browse the full notebook tree below.</p>
          <div class="pill-grid">
            {{- range $sections -}}
              <a class="pill" href="#{{ anchorize .Title }}">{{ .Title }}</a>
            {{- end -}}
          </div>
        </div>
        <div class="note-map">
          <h2>Topic Map</h2>
          <p class="summary">Structured like a notebook: categories, subtopics, and individual notes.</p>
          {{- range $sections -}}
            <section class="note-category" id="{{ anchorize .Title }}">
              <div class="note-category-header">
                <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
                <p>{{ .Params.summary | default .Summary }}</p>
              </div>
              <ul class="note-list note-list-root">
                {{- range .Pages.ByTitle -}}
                  <li class="note-leaf">
                    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                    {{ with .Params.summary }}<span class="note-meta">{{ . }}</span>{{ end }}
                  </li>
                {{- end -}}
                {{- range .Sections.ByWeight -}}
                  {{ partial "pentest-map-node.html" (dict "section" .) }}
                {{- end -}}
              </ul>
            </section>
          {{- end -}}
        </div>
      </div>
    </div>
  </div>
</section>
<script src="/js/tree.js" defer></script>
{{ end }}
