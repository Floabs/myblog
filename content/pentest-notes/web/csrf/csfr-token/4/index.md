---
title: "4."
date: 2025-05-18
summary: "Notes and commands for 4.."
tags: ["web", "csrf", "csfr-token", "4"]
---
Extra header which ties csfr token to a cookie but not necassarily the session cookie and email change ist dependend on csfr token.

Hard to exploit but possible You need to be able to set a session cookie in victim broswer f,e, xss

   1) you log in with your account and get csfr token + session cookie 2) set session cookie in victim browser 3) You set the header with your session and csfr key. 4) feed actual victim token to change email.

Sidenote, cookies have often a scope for an entire DNS zone all subdomains etc, and its viable anywhere to set / cahnge it.

Attack: 1, See if the CSFR token is tied to the CSFR cookie
	- submit invalid CSFR token.

	- submit a valid CSFR from a DIFFERET user.
			Important -> use a different browser or incognito

2. Submit valid CSRF token and CSFR cookie (attacker) and a different session cookie(victim).
### Grabbing the csfrKey( under cookiescookie)

		attacker: CSFR-token: RnGR8OFyDtnJIIdhsHA5UWunvJqsJ4OE CSFRKEY-(session): dlas0qWnJekQLfc26D9graV10QqMIkXp

		So we can change the email of a user cause its bound to session -cookie by using our 2 CFSRs

### Now what we need to be able to do
	1. Inject a csfrKey cookie in the user's session (HTTP Header injection)
	2.  Send a CSFR attack to the victim with a known csfr token.

Find a vulnerability for a http-header injection: The last searched item goes into the cookies.

	Write a payload: new is the http header rinjection, rest is basically same liek all others.

![Screenshot](7d388c3cf44f48efda1fa831686d4df463ab913138b9e4cb8d2d886040831467.png)
![Screenshot](26a60a8fcbb23b39487ebf8ecdf3be28fb9ffab2139cefb24e60d7310c01679b.png)
![Screenshot](171c4488b22cb049f899652d83a53216061207db8edbfad516d99e0c04010b65.png)
![Screenshot](d85e85f1292c374e971de1d532f33505fa92da88b399eb89b72e29bb4f0086f0.png)
![Screenshot](e1b214cc9838bc4ec64cbfe92b62b49836c9b2a475c1e4180516043cd9671dc5.png)
![Screenshot](56d0ff62ffccbffb654dfc97d61b9ed1603d5b4009f0fbe96ef894e6de2ace89.png)
